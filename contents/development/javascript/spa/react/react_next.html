<!DOCTYPE html>

<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta http-equiv="Content-Script-Type" content="text/javascript" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="ITエンジニアがこれまで学んだことを整理するサイト" />

    <link rel="stylesheet" href="../../../../../css/style.css">
    <link rel="stylesheet" href="../../../../../css/print.css" media="print">
    <script src="../../../../../js/openclose.js"></script>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <title>とあるＩＴエンジニアの知識整理</title>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-141266564-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-141266564-1');
    </script>
    <script data-ad-client="ca-pub-5924490903263360" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  </head>

  <!--PC用（801px以上端末）で表示させるブロック-->
  <header class="pc">
    <h1 class="logo">
      <a href="https://taumax-github.github.io/"><img src="../../../../../images/icon_twitter_card.png" alt="TOP"></a>
    </h1>

    <!--PC用（801px以上端末）メニュー-->
    <nav id="menubar">
      <ul class="none">
        <li class="menuimg menu1"><a href="https://taumax-github.github.io/"><span>Home</span></a></li>
      </ul>
    </nav>
    <ul class="icon">
      <li><a href="https://twitter.com/taumax_" target="_blank"><img src="../../../../../images/icon_twitter.png" alt="Twitter"></a></li>
      <li><a href="https://qiita.com/taumax" target="_blank"><img src="../../../../../images/icon_qiita.png" alt="Qiita"></a></li>
    </ul>
    <ul class="indent_no">
      <li><a href="#react">React</a></li>
      <li><a href="#jsx">JSX</a></li>
      <li><a href="#component">ｺﾝﾎﾟｰﾈﾝﾄ</a></li>
      <li><a href="#hooks">Hooks</a></li>
      <li><a href="#next">Next.js</a></li>
      <li><a href="#rendering">ﾚﾝﾀﾞﾘﾝｸﾞ</a></li>
      <li><a href="#filebase_routing">ﾌｧｲﾙﾍﾞｰｽ<br/>ﾙｰﾃｨﾝｸﾞ</a></li>
      <li><a href="#what_i_made">作った物</a></li>
    </ul>
  </header><!--/.pc-->

  <!--小さな端末用（800px以下端末）で表示させるブロック-->
  <header class="sh">
    <!--小さな端末用（800px以下端末）メニュー-->
    <div id="menubar-s">
      <h1 class="logo">
        <a href="https://taumax-github.github.io/"><img src="../../../../../images/icon_twitter_card.png" alt="SAMPLE SITE"></a>
      </h1>
      <nav>
        <ul class="none">
          <li class="menuimg menu1"><a href="https://taumax-github.github.io/"><span>Home</span></a></li>
        </ul>
      </nav>
      <ul class="icon">
        <li><a href="https://twitter.com/taumax_" target="_blank"><img src="../../../../../images/icon_twitter.png" alt="Twitter"></a></li>
        <li><a href="https://qiita.com/taumax" target="_blank"><img src="../../../../../images/icon_qiita.png" alt="Qiita"></a></li>
      </ul>
      <ul class="indent_no">
        <li><a href="#react">React</a></li>
        <li><a href="#jsx">JSX</a></li>
        <li><a href="#component">ｺﾝﾎﾟｰﾈﾝﾄ</a></li>
        <li><a href="#hooks">Hooks</a></li>
        <li><a href="#next">Next.js</a></li>
        <li><a href="#rendering">レンダリング</a></li>
        <li><a href="#filebase_routing">ファイルベースルーティング</a></li>
        <li><a href="#what_i_made">作った物</a></li>
      </ul>
    </div><!--/#menubar-s-->
  </header><!--/.sh-->

  <body class="defaultbody">
    <div id="container">
    <div id="contents">
    <div id="main">
      <span id="pagetop"></span>
      <section class="box">

        <!-- tweetボタン -->
        <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-show-count="false">Tweet</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

        <h2 class="title">React/Next.js</h2>

        <ul class="breadcrumb">
          <li class="breadcrumbli"><a href="../../../../../index.html">ホーム</a></li>
          <li class="breadcrumbli"> > <a href="../../js_index.html">JavaScript</a></li>
          <li class="breadcrumbli"> > <a href="../spa.html">SPA</a></li>
          <li class="breadcrumbli"> > React/Next.js</li>
        </ul>

        <br/>
        <span id="react"></span>
        <h3 class="title">React</h3>
        <p>
          Reactとは、WebサイトやWebアプリのUI部分を開発する際に活用するJavaScriptライブラリです。ReactはMeta (旧Facebook社)が開発し、2013年にオープンソース化されました。<br/>
          リアクティブ・プログラミングを特徴としています。リアクティブとは、『何かの値が変化したり、何かしらイベントが発生するとそれがすぐに反映される仕組み』のことです。<br/>
          ReactはJavaScript用のフレームワークと勘違いされることがありますが、実際には上述の通りライブラリとなります。CDN(Contents Delivery Network)経由でhtmlファイル内でReactのライブラリを使用することができます。<br/>
          以下は実際にReactのライブラリを使用して書いたものです。<br/>
          ↓クリックでcounter増加<br/>
        </p>

        <style>
          #root {
            cursor: pointer;
            font-size: 20pt;
            background-color: lightblue;
            color: black;
            padding: 10px 1px 5px 1px;
          }
        </style>
        <div id="root" onClick="doCount();">wait....</div>
        <script>
          let counter = 0;
          let dom = document.querySelector('#root');
          doCount();

          function doCount() {
            counter++
            let element = React.createElement(
              'p', {}, "counter: " + counter
            )
            ReactDOM.render(element, dom)
          }
        </script>

        <br/><br/>
        <p>上記のソースコード（抜粋）</p>

<pre class="title"><code class="title">react_next.html</code></pre>
<pre><code>&lt;head&gt;
&lt;script src="https://unpkg.com/react@18/umd/react.development.js"&gt;&lt;/script&gt;
&lt;script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js">&lt;/script&gt;
&lt;/head&gt;

&lt;style&gt;
  #root {
    cursor: pointer;
    font-size: 20pt;
    background-color: lightblue;
    color: black;
    padding: 10px 1px 5px 1px;
  }
&lt;/style&gt;
&lt;div id="root" onClick="doCount();">wait....&lt;/div&gt;
&lt;script&gt;
  let counter = 0;
  let dom = document.querySelector('#root');
  doCount();

  function doCount() {
    counter++
    let element = React.createElement(
      'p', {}, "counter: " + counter
    )
    ReactDOM.render(element, dom)
  }
&lt;/script&gt;
</code></pre>

        <br/>
        上記はCDNを使用していますが、これは主に学習目的または小規模のアプリケーション目的での使用が適しています。<br/>
        大規模な開発をする場合、Reactで重要な概念として以下3つがあります。<br/>
        <ul>
          <li><a href="#jsx">JSX(JavaScript XML)</a></li>
          <li><a href="#component">コンポーネント</a></li>
          <li><a href="#hooks">React Hooks</a></li>
        </ul>

        <br/>
        <span id="jsx"></span>
        <h4 class="title">JSX(JavaScript XML)</h4>
        <p>
          JSXはJavaScriptの構文拡張で、JavaScriptファイル内にHTMLのようなコードを記述できるようにするものです。Meta（旧Facebook社）によって開発されました。たとえば、次のようなコードを書くことが出来ます。<br/>
          <code>const heading = &lt;h1&gt;Hello, JSX!&lt;/h1&gt;;</code><br/>
          このコードはHTMLのようにも見えますが、JavaScriptのコードです。headingという定数を作り、その定数にHTMLの要素（React要素）を代入しています。<br/>
          JSXを記述する場合、ファイルの拡張子は<code>.jsx</code>とします。これに<a href="../../typescript.html">TypeScript</a>を適用する場合、拡張子は<code>.tsx</code>とします。<br/>
          JSXでは中括弧 { } を使うことで、以下のようにReact要素内にJavaScriptの値を埋め込むことができます。<br/>
          <br/>
          <code>
            let name = 'React';<br/>
            const heading = &lt;h1&gt;Hello, {name}&lt;/h1&gt;;
          </code><br/>
        </p>

        <br/>
        <span id="component"></span>
        <h4 class="title">コンポーネント</h4>
        <p>
          Reactでは、自分が書いたマークアップ、CSS、JavaScript を、アプリのための再利用可能な UI 要素にまとめることができます。これを『コンポーネント』と呼びます。<br/>
          以下はWebサイトに表示するページのフッター部分を <code>CommonFooter</code> という名前でコンポーネント化したものです。<br/>
        </p>

<pre class="title"><code class="title">common_footer.tsx</code></pre>
<pre><code>export default function CommonFooter(labelKey: any): JSX.Element {
  return (
    &lt;div&gt;
      &lt;footer&gt;
        &lt;p className="rights"&gt;
          ...
        &lt;/p&gt;
      &lt;/footer&gt;
    &lt;/div&gt;
  );
}
</code></pre>

      <br/>
      <p>
        コンポーネント化したフッターを呼び出す際は <code>&lt;CommonFooter /&gt;</code> と記述します。<br/>
        以下は同じくコンポーネント化した CommonBody というコンポーネントから CommonFooter を呼び出しているサンプルです。<br/>
      </p>

<br/>
<pre class="title"><code class="title">common_body.tsx</code></pre>
<pre><code>export default function CommonBody(body: any): JSX.Element {
  &lt;body&gt;
    &lt;section className="box"&gt;
      {body.message}
      ...
    &lt;/section&gt;
    &lt;CommonFooter /&gt;  {/* &lt;!--/#main--&gt; */}
  &lt;/body&gt;
}
</code></pre>

        <br/>
        <span id="hooks"></span>
        <h4 class="title">React Hooks</h4>
        <p>
          React Hooksはフック(Hook)によって関数コンポーネント内で状態やライフサイクルを扱うための機能です。<br/>
          公式が提供しているフックは10種類あり、さらにフックを組み合わせてカスタムフックを独自に実装できます。<br/>
        </p>

        <table border="1">
          <tr><th>フック種類</th><th>用途（概要）</th><th>フック名</th></tr>
          <tr><td rowspan="2">状態のフック<br/>(State Hooks)</td><td rowspan="2">内部状態を持ち、その状態の変化に応じて表示を変更できる。</td><td>useState</td></tr>
          <tr><td>useReducer</td></tr>
          <tr><td rowspan="2">メモ化のフック<br/>(Performance Hooks)</td><td rowspan="2">値や関数を保持し、必要のない子要素のレンダリングや計算を抑止するために使用し、パフォーマンスの最適化を図る</td><td>useCallback</td></tr>
          <tr><td>useMemo</td></tr>
          <tr><td rowspan="2">副作用のフック<br/>(Effect Hooks)</td><td rowspan="2">副作用（コンポーネントの描画とは直接関係ない処理のこと）のためのフック。外部システムとの同期、イベントリスナ。</td><td>useEffect</td></tr>
          <tr><td>useLayoutEffect</td></tr>
          <tr><td>Contextのためのフック<br/>(Context Hooks)</td><td>親の変数を子コンポーネントで受け取る</td><td>useContext</td></tr>
          <tr><td rowspan="2">refのフック<br/>(Ref Hooks)</td><td rowspan="2">レンダリングに使用しない情報を記録</td><td>useRef</td></tr>
          <tr><td>useImperativeHandle</td></tr>
          <tr><td>Other Hooks</td><td>ライブラリ開発時に利用されるHooks</td><td>useDebugValue</td></tr>
        </table>

        <br/>
        <p>
          ReactではこのReact Hooksを利用してリアクティブなシステムを構築していきます。<br/>
          例えば状態のフックであるuseStateなら以下のようなコーディングをすることでリアクティブにすることができます。<br/>
        </p>

<pre><code>const [状態, 更新関数] = useState(初期状態)</code></pre>
<pre><code>const [count, setCount] = useState(0);
&lt;div&gt;
  &lt;p&gt;Count: {count}&lt;/p&gt;
  &lt;button onClick={() => setCount(count + 1)}&gt;+&lt;/button&gt;
&lt;/div&gt;
</code></pre>

        <br/>
        <span id="next"></span>
        <h3 class="title">Next.js</h3>
        <p>
          ここではNext.jsの機能について記載していきます。
        </p>

        <br/>
        <span id="rendering"></span>
        <h4 class="title">レンダリング</h4>
        <p>
          Nextで使えるレンダリング手法とその概要は<a href="../spa.html#rendering">こちら</a>に記載しているので、どのようにしてそれを実現するかを記載します。<br/>

          <br/>
          Nextでは、所定の関数を呼び出すことでレンダリングモードを制御します。使用する関数は以下です。getServerSideProps, getStaticProps と getStaticPaths は export する必要があります。<br/>
        </p>
        <ul>
          <li>getServerSideProps：ページを描画する前に呼ばれる。この関数が返した props を元にページが描画される。</li>
          <li>getStaticProps：ビルド時に実行される。revalidateに数値（秒数）を指定して返すと、指定秒数経過後に再レンダリングされる。</li>
          <li>getStaticPaths：事前にすべてのページを生成せず、必要に応じてhtml生成、およびキャッシュからの返却を行う。pathsにないパスに対してリクエストがあったときに、fallbackキーの値によって挙動が異なる。</li>
          <li>unstable_revalidate：当該関数が実行されたタイミングで、getStaticPropsを使用しているページが再レンダリングされる。</li>
        </ul>

        <br/>
        <p>
          それぞれ対応するレンダリングモードは以下の通り。
        </p>

        <table border="1">
          <tr><th>レンダリング手法</th><th>関数名</th></tr>
          <tr><td>SSR(Server-Side Rendering)</td><td>getServerSideProps</td></tr>
          <tr><td>CSR(Client-Side Rendering)</td><td>-（デフォルトがCSRなので使用する関数は無し）</td></tr>
          <tr><td>SSG(Static Site Generation)</td><td>getStaticProps</td></tr>
          <tr><td>ISG(Incremental Static Generation)</td><td>getStaticPaths</td></tr>
          <tr><td>ISR(Incremental Static Regeneration)</td><td>revalidateを返すgetStaticProps</td></tr>
          <tr><td>On Demand ISR<br/>(On Demand Incremental Static Regeneration)</td><td>revalidateを返すgetStaticPropsとunstable_revalidateの組み合わせ</td></tr>
        </table>

        <br/>
        <span id="filebase_routing"></span>
        <h4 class="title">ファイルベースルーティング</h4>
        <p>
          Next.jsの「ファイルベースルーティング」は、pagesディレクトリ内のファイル構成がそのままアプリケーションのページ構成になるという機能です。pages ディレクトリ配下にスクリプトファイルを配置すると、それを使って画面表示を行います。<br/>
          例えば以下の画像のように配置した場合、 <code>http://[ホスト名]/saga1/ability/ability_detail</code> というurlで <code>ability_detail.tsx</code> の内容が表示されます。<br/>

          <br/>
          <img src="./img/next_project.jpg" style="border: solid 1px #FFFFFF"/><br/>

          <br/>
          Next.js では、すべてのページの初期化に App というコンポーネントを使用しています。<code>pages/_app.tsx</code> を作成することで、Appコンポーネントをカスタマイズできます。全ページに共通のcssを適応するなど、すべてのページで共通な処理などを書くことができます。<br/>
          <img src="./img/_app.jpg" style="border: solid 1px #FFFFFF"/><br/>

          <br/>
          以下のコードは<code>_app.tsx</code>の中身です。1行目で<code>import '../styles/style.css'</code>を記述することで、pages配下のすべてのページに <code>style.css</code> が適応されます。<br/>
        </p>

<pre class="title"><code class="title">_app.tsx</code></pre>
<pre><code>import '../styles/style.css'
function MyApp({ Component, pageProps }) {
  return <Component {...pageProps} />
}
export default MyApp
</code></pre>


        <br/>
        <span id="what_i_made"></span>
        <h3 class="title">作った物</h3>
        <p>
          <img src="./img/コンポーネント構造.jpg" width="500"/><br/>
        </p>

        <ul>
          <li>魔界塔士サガの仲間モンスター一覧</li>
          <li>変身後モンスター算出</li>
          <li>能力一覧</li>
        </ul>

        <br/>
        <p>
          モンスター詳細情報のまとめ。<br/>
          各モンスターの詳細画面と、変身後モンスター算出の詳細欄にお暗示内容が出力される。<br/>
          同じ内容を書きたくないので、body部をクラス内に記載し、それを詳細画面と変身後モンスター算出の詳細欄の両方で流用する形にしている。<br/>
          <a href="https://sagamax.cyou/games/saga1/monster/monster_transform" target="_blank" rel="noopener noreferrer">モンスター情報</a><br/>
          <img src="img/モンスター情報.jpg" width="500"/><br/>

          <br/>
          モンスターが使用する能力の詳細。<br/>
          画面のレイアウトをReactで記載し、表示する情報自体はDBに格納。<br/>
          URLからIDを取得してそれをもとにDBから情報を取得して画面にレンダリング。<br/>
          <a href="https://sagamax.cyou/games/saga1/ability/ability_detail?ability_id=0001" target="_blank" rel="noopener noreferrer">能力詳細</a><br/>
          <img src="img/能力詳細.jpg" width="500"/><br/>
        </p>

        <br/>
        <hr>

        <br/>
        参考書籍<br/>
        <ul>
          <li><a href="https://amzn.to/4cx3seQ" target="_blank" rel="noopener noreferrer"><img src="../img/react_next.jpg" width="200"/><br/>React.js&Next.js超入門 第2版</a></li>
          <li><a href="https://amzn.to/4as09nr" target="_blank" rel="noopener noreferrer"><img src="../img/typescript_react_next.jpg" width="200"/><br/>TypeScriptとReact/Next.jsでつくる実践Webアプリケーション開発</a></li>
        </ul>

        <br/>
        参考サイト<br/>
        <ul>
          <li><a href="https://kinsta.com/jp/knowledgebase/what-is-jsx/" target="_blank" rel="noopener noreferrer">kinsta Reactで使用するJSXの基本をわかりやすく解説</a></li>
          <li><a href="https://qiita.com/kamenaris/items/8bcb407007501326bd9d" target="_blank" rel="noopener noreferrer">Qiita Next.jsの_documment..tsxと_app.tsxについてメモ</a></li>
          <li><a href="https://weseek.co.jp/tech/703/" target="_blank" rel="noopener noreferrer">WESEEK Tech Blog 煩わしい設定は一切なし!Next.jsでCSS を使う方法</a></li>
          <li><a href="https://tyotto-good.com/nextjs/document-app" target="_blank" rel="noopener noreferrer">Tyotto good! Next.jsの_documment.js(tsx)と_app.js(tsx)について爆速で理解しよう</a></li>
          <li><a href="https://qiita.com/tetsutaroendo/items/c7171286137d963cdecf" target="_blank" rel="noopener noreferrer">Qiita Next.jsの_app.jsと_document.js</a></li>
          <li><a href="https://dev-k.hatenablog.com/entry/how-to-use-react-in-cdn-dev-k" target="_blank" rel="noopener noreferrer">deve.K's Programming Primer - プログラミング初心者のための入門ブログ</a></li>
          <li><a href="https://zenn.dev/kaitok/articles/7a81c497252189" target="_blank" rel="noopener noreferrer">Zenn React Hooks 再入門</a></li>
          <li><a href="https://weseek.co.jp/tech/703/" target="_blank" rel="noopener noreferrer">WESEEK Tech Blog 煩わしい設定は一切なし!Next.jsでCSS を使う方法</a></li>
          <li><a href="https://dev.classmethod.jp/articles/next-js-12-1/" target="_blank" rel="noopener noreferrer">DevelopersIO Next.js 12.1の新機能オンデマンド ISRでページを手動再検証させてみた</a></li>
          <li><a href="https://zenn.dev/shimabukuromeg/articles/955cea236650d4" target="_blank" rel="noopener noreferrer">Zenn On-demand ISRの機能を試してみた</a></li>
          <li><a href="https://kk-web.link/blog/20220412" target="_blank" rel="noopener noreferrer">kk-web Next.jsのOn-demand Revalidationの簡単な説明</a></li>
          <li><a href="https://scrapbox.io/teamlab-frontend/SSR,_CSR,_SSG,_ISG,_ISR%E3%81%AE%E9%81%95%E3%81%84%E3%81%A8%E4%BD%BF%E3%81%84%E5%88%86%E3%81%91%E6%96%B9%E3%80%82%E3%81%9D%E3%82%8C%E3%81%9E%E3%82%8CNext.js%E3%81%A7Todo%E3%82%A2%E3%83%97%E3%83%AA%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F%E3%80%82" target="_blank" rel="noopener noreferrer">teamlab-frontend SSR, CSR, SSG, ISG, ISRの違いと使い分け方。それぞれNext.jsでTodoアプリ作ってみた。</a></li>
          <li><a href="https://note.com/meg_t/n/n286d6b52073e" target="_blank" rel="noopener noreferrer">note Next.jsのIncremental Static Regenerationが凄い</a></li>
          <li><a href="https://zenn.dev/k_kazukiiiiii/articles/dc14b9249d0255" target="_blank" rel="noopener noreferrer">Zenn Next.js + TypeScript | CSR・SSR・SG・ISG・ISR・On Demand ISR の違いをコード付きで解説</a></li>
        </ul>
      </section><!-- section class="box" -->

      <footer>
        <small><a href="https://taumax-github.github.io/">とあるＩＴエンジニアの知識整理</a> All Rights Reserved.</small>
        <span class="pr"><a href="https://template-party.com/" target="_blank">《Web Design:Template-Party》</a></span>
      </footer>

    </div><!--/#main-->
    </div><!--/#contents-->
    </div><!--/#container-->
  </body>

  <!--ページの上部に戻る「↑」ボタン-->
  <p class="nav-fix-pos-pagetop"><a href="#pagetop">↑</a></p>

  <!--メニュー開閉ボタン-->
  <div id="menubar_hdr" class="close"></div>
    <!--メニューの開閉処理条件設定　800px以下-->
    <script>
      if (OCwindowWidth() <= 800) {
        open_close("menubar_hdr", "menubar-s");
      }
    </script>
</html>
